# Electron è¿è¡Œä¸æ‰“åŒ… MCP Server æ‹“æ‰‘

## å¼€å‘æ¨¡å¼ vs ç”Ÿäº§æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¼€å‘æ¨¡å¼ (npm start)                          â”‚
â”‚                                                                     â”‚
â”‚  é¡¹ç›®ç›®å½•ç»“æ„:                                                       â”‚
â”‚                                                                     â”‚
â”‚  mobile-mcp/                    â† getProjectRoot() è¿”å›æ­¤è·¯å¾„        â”‚
â”‚  â”œâ”€â”€ frontend/                  â† Electron + React æºç               â”‚
â”‚  â”‚   â”œâ”€â”€ src/                                                       â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ main.ts            â† Electron ä¸»è¿›ç¨‹å…¥å£               â”‚
â”‚  â”‚   â”‚   â””â”€â”€ mcp-manager.ts     â† MCP Server è¿›ç¨‹ç®¡ç†               â”‚
â”‚  â”‚   â””â”€â”€ .vite/build/main.js    â† Vite ç¼–è¯‘åçš„ä¸»è¿›ç¨‹ä»£ç             â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€â”€ mcp_tools/                                                     â”‚
â”‚  â”‚   â””â”€â”€ mcp_server.py          â† getMcpServerPath() æŒ‡å‘æ­¤æ–‡ä»¶      â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€â”€ core/                      â† Python è®¾å¤‡ç®¡ç†æ ¸å¿ƒä»£ç             â”‚
â”‚  â”‚   â”œâ”€â”€ mobile_client.py                                           â”‚
â”‚  â”‚   â”œâ”€â”€ device_manager.py                                          â”‚
â”‚  â”‚   â””â”€â”€ ...                                                        â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€â”€ agent-app/                                                     â”‚
â”‚  â”‚   â””â”€â”€ .venv/                 â† getPythonPath() ä¼˜å…ˆæ£€æµ‹           â”‚
â”‚  â”‚       â””â”€â”€ bin/python                                             â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â””â”€â”€ .venv/                     â† getPythonPath() å¤‡é€‰æ£€æµ‹           â”‚
â”‚      â””â”€â”€ bin/python                                                 â”‚
â”‚                                                                     â”‚
â”‚  è·¯å¾„è§£æ:                                                           â”‚
â”‚  __dirname = frontend/src/  (Vite dev æ¨¡å¼)                          â”‚
â”‚  getProjectRoot() = path.resolve(__dirname, "..", "..")              â”‚
â”‚                   = mobile-mcp/                                     â”‚
â”‚  getMcpServerPath() = mobile-mcp/mcp_tools/mcp_server.py            â”‚
â”‚  getPythonPath()    = mobile-mcp/agent-app/.venv/bin/python          â”‚
â”‚                       æˆ– mobile-mcp/.venv/bin/python                 â”‚
â”‚                       æˆ– "python" (ç³»ç»Ÿ)                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”Ÿäº§æ¨¡å¼ (æ‰“åŒ…åçš„ .app / .exe)                    â”‚
â”‚                                                                     â”‚
â”‚  æ‰“åŒ…åç›®å½•ç»“æ„:                                                     â”‚
â”‚                                                                     â”‚
â”‚  Mobile Agent.app/                                                  â”‚
â”‚  â””â”€â”€ Contents/                                                      â”‚
â”‚      â”œâ”€â”€ MacOS/                                                     â”‚
â”‚      â”‚   â””â”€â”€ Mobile Agent       â† Electron å¯æ‰§è¡Œæ–‡ä»¶               â”‚
â”‚      â”‚                                                               â”‚
â”‚      â””â”€â”€ Resources/             â† process.resourcesPath             â”‚
â”‚          â”‚                                                           â”‚
â”‚          â”œâ”€â”€ app.asar           â† Electron åº”ç”¨ä»£ç  (asar æ‰“åŒ…)      â”‚
â”‚          â”‚   â”œâ”€â”€ .vite/                                              â”‚
â”‚          â”‚   â”‚   â””â”€â”€ build/                                          â”‚
â”‚          â”‚   â”‚       â””â”€â”€ main.js  â† ç¼–è¯‘åçš„ä¸»è¿›ç¨‹ + mcp-manager     â”‚
â”‚          â”‚   â””â”€â”€ package.json                                        â”‚
â”‚          â”‚                                                           â”‚
â”‚          â”œâ”€â”€ mcp_tools/         â† âš ï¸ éœ€è¦é¢å¤–é…ç½®æ‰“åŒ…               â”‚
â”‚          â”‚   â””â”€â”€ mcp_server.py                                      â”‚
â”‚          â”‚                                                           â”‚
â”‚          â”œâ”€â”€ core/              â† âš ï¸ éœ€è¦é¢å¤–é…ç½®æ‰“åŒ…               â”‚
â”‚          â”‚   â”œâ”€â”€ mobile_client.py                                   â”‚
â”‚          â”‚   â”œâ”€â”€ device_manager.py                                  â”‚
â”‚          â”‚   â””â”€â”€ ...                                                â”‚
â”‚          â”‚                                                           â”‚
â”‚          â””â”€â”€ .venv/             â† âš ï¸ éœ€è¦é¢å¤–é…ç½®æ‰“åŒ…               â”‚
â”‚              â””â”€â”€ bin/python     â† æˆ–ä½¿ç”¨ç³»ç»Ÿ Python                  â”‚
â”‚                                                                     â”‚
â”‚  è·¯å¾„è§£æ:                                                           â”‚
â”‚  getProjectRoot() = process.resourcesPath                            â”‚
â”‚                   = .../Resources/                                   â”‚
â”‚  getMcpServerPath() = Resources/mcp_tools/mcp_server.py             â”‚
â”‚  getPythonPath()    = Resources/.venv/bin/python                     â”‚
â”‚                       æˆ– "python" (ç³»ç»Ÿ)                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Electron å¯åŠ¨ MCP Server çš„å®Œæ•´æµç¨‹

```
æ—¶é—´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

â”Œâ”€ Electron Main Process (main.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚  app.whenReady()                                                     â”‚
â”‚      â”‚                                                               â”‚
â”‚      â–¼                                                               â”‚
â”‚  â‘  startMcpServer()  (mcp-manager.ts)                               â”‚
â”‚      â”‚                                                               â”‚
â”‚      â”œâ”€â”€ getPythonPath()                                             â”‚
â”‚      â”‚   â”œâ”€â”€ æ£€æŸ¥ $MCP_PYTHON ç¯å¢ƒå˜é‡                               â”‚
â”‚      â”‚   â”œâ”€â”€ æ£€æŸ¥ {root}/.venv/bin/python                           â”‚
â”‚      â”‚   â”œâ”€â”€ æ£€æŸ¥ {root}/agent-app/.venv/bin/python                 â”‚
â”‚      â”‚   â””â”€â”€ å›é€€: "python"                                         â”‚
â”‚      â”‚                                                               â”‚
â”‚      â”œâ”€â”€ getMcpServerPath()                                          â”‚
â”‚      â”‚   â””â”€â”€ {root}/mcp_tools/mcp_server.py                         â”‚
â”‚      â”‚                                                               â”‚
â”‚      â”œâ”€â”€ spawn(pythonCmd, [scriptPath, "--sse", "--port", "3100"])   â”‚
â”‚      â”‚   â”‚                                                           â”‚
â”‚      â”‚   â”‚  â”Œâ”€ MCP Server å­è¿›ç¨‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚      â”‚   â”‚  â”‚                                                     â”‚ â”‚
â”‚      â”‚   â”‚  â”‚  sys.argv: ["mcp_server.py", "--sse", "--port",     â”‚ â”‚
â”‚      â”‚   â”‚  â”‚             "3100"]                                  â”‚ â”‚
â”‚      â”‚   â”‚  â”‚                                                     â”‚ â”‚
â”‚      â”‚   â”‚  â”‚  if "--sse" in sys.argv:                            â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”œâ”€â”€ from mcp.server.sse import SseServerTransportâ”‚
â”‚      â”‚   â”‚  â”‚      â”œâ”€â”€ from starlette.applications import Starletteâ”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”œâ”€â”€ import uvicorn                             â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”‚                                              â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”œâ”€â”€ Starlette(routes=[                         â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”‚     Route("/sse", endpoint=handle_sse),      â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”‚     Route("/messages", endpoint=handle_msg), â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”‚   ])                                         â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”‚                                              â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â””â”€â”€ uvicorn.run(app, host="0.0.0.0",          â”‚ â”‚
â”‚      â”‚   â”‚  â”‚                      port=3100)                     â”‚ â”‚
â”‚      â”‚   â”‚  â”‚          â””â”€â”€ ğŸŸ¢ HTTP Server å°±ç»ª                    â”‚ â”‚
â”‚      â”‚   â”‚  â”‚                                                     â”‚ â”‚
â”‚      â”‚   â”‚  â”‚  é¦–æ¬¡å·¥å…·è°ƒç”¨ â†’ MobileMCPServer.initialize()        â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”œâ”€â”€ _detect_platform() â†’ "android"/"ios"      â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”œâ”€â”€ MobileClient(platform)                    â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”‚   â”œâ”€â”€ DeviceManager.connect()               â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”‚   â”‚   â””â”€â”€ u2.connect(device_id)             â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â”‚   â””â”€â”€ ğŸŸ¢ è®¾å¤‡è¿æ¥å°±ç»ª                       â”‚ â”‚
â”‚      â”‚   â”‚  â”‚      â””â”€â”€ BasicMobileToolsLite(client)              â”‚ â”‚
â”‚      â”‚   â”‚  â”‚          â””â”€â”€ ğŸŸ¢ 27 ä¸ªå·¥å…·å°±ç»ª                      â”‚ â”‚
â”‚      â”‚   â”‚  â”‚                                                     â”‚ â”‚
â”‚      â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â”‚   â”‚                                                           â”‚
â”‚      â”‚   â”œâ”€â”€ stdout â†’ console.log("[MCP stdout] ...")               â”‚
â”‚      â”‚   â”œâ”€â”€ stderr â†’ console.log("[MCP stderr] ...")               â”‚
â”‚      â”‚   â”œâ”€â”€ on("exit") â†’ mcpProcess = null                        â”‚
â”‚      â”‚   â””â”€â”€ on("error") â†’ å¯åŠ¨å¤±è´¥æ—¥å¿—                             â”‚
â”‚      â”‚                                                               â”‚
â”‚      â–¼                                                               â”‚
â”‚  â‘¡ createWindow()                                                    â”‚
â”‚  â‘¢ installExtensions()                                               â”‚
â”‚  â‘£ checkForUpdates()                                                 â”‚
â”‚  â‘¤ setupORPC()                                                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€ åº”ç”¨é€€å‡º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  app.on("will-quit")                                            â”‚ â”‚
â”‚  â”‚      â”‚                                                          â”‚ â”‚
â”‚  â”‚      â–¼                                                          â”‚ â”‚
â”‚  â”‚  stopMcpServer()                                                â”‚ â”‚
â”‚  â”‚      â”œâ”€â”€ mcpProcess.kill("SIGTERM")                             â”‚ â”‚
â”‚  â”‚      â”œâ”€â”€ setTimeout(3000) â†’ mcpProcess.kill("SIGKILL")         â”‚ â”‚
â”‚  â”‚      â””â”€â”€ on("exit") â†’ clearTimeout, mcpProcess = null          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Electron Forge æ‰“åŒ…æµç¨‹

```
æºç                      Forge æ„å»º                        äº§ç‰©
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€â”€â”€â”€

frontend/               electron-forge make
â”œâ”€â”€ src/                    â”‚
â”‚   â”œâ”€â”€ main.ts  â”€â”€â”€â”€â”€â”€â–º   â”œâ”€â”€ Vite ç¼–è¯‘ä¸»è¿›ç¨‹ â”€â”€â”€â”€â”€â–º  .vite/build/main.js
â”‚   â”œâ”€â”€ preload.ts â”€â”€â”€â”€â–º   â”œâ”€â”€ Vite ç¼–è¯‘é¢„åŠ è½½ â”€â”€â”€â”€â–º  .vite/build/preload.js
â”‚   â””â”€â”€ (renderer) â”€â”€â”€â”€â–º   â”œâ”€â”€ Vite ç¼–è¯‘æ¸²æŸ“è¿›ç¨‹ â”€â”€â–º  renderer/main_window/
â”‚                           â”‚
â”œâ”€â”€ forge.config.ts         â”œâ”€â”€ packagerConfig: { asar: true }
â”‚                           â”‚   â””â”€â”€ å°† .vite/ + package.json æ‰“å…¥ app.asar
â”‚                           â”‚
â”‚                           â”œâ”€â”€ FusesPlugin:
â”‚                           â”‚   â”œâ”€â”€ RunAsNode: false
â”‚                           â”‚   â”œâ”€â”€ OnlyLoadAppFromAsar: true
â”‚                           â”‚   â””â”€â”€ EnableEmbeddedAsarIntegrityValidation: true
â”‚                           â”‚
â”‚                           â””â”€â”€ Makers:
â”‚                               â”œâ”€â”€ MakerSquirrel  â†’ Windows .exe å®‰è£…åŒ…
â”‚                               â”œâ”€â”€ MakerZIP       â†’ macOS .zip åˆ†å‘åŒ…
â”‚                               â”œâ”€â”€ MakerDeb       â†’ Linux .deb åŒ…
â”‚                               â””â”€â”€ MakerRpm       â†’ Linux .rpm åŒ…


app.asar å†…éƒ¨ç»“æ„:

  app.asar (åªè¯»å‹ç¼©å½’æ¡£)
  â”œâ”€â”€ .vite/
  â”‚   â””â”€â”€ build/
  â”‚       â”œâ”€â”€ main.js         â† ä¸»è¿›ç¨‹ (å« mcp-manager é€»è¾‘)
  â”‚       â””â”€â”€ preload.js      â† é¢„åŠ è½½è„šæœ¬
  â”œâ”€â”€ renderer/
  â”‚   â””â”€â”€ main_window/
  â”‚       â”œâ”€â”€ index.html      â† React åº”ç”¨å…¥å£
  â”‚       â””â”€â”€ assets/         â† JS/CSS/å­—ä½“
  â””â”€â”€ package.json            â† main: ".vite/build/main.js"
```

---

## Python ä»£ç æ‰“åŒ…ç­–ç•¥

### å½“å‰æ–¹æ¡ˆï¼šextraResource å¤–éƒ¨æ–‡ä»¶

```
âš ï¸ å½“å‰ forge.config.ts ä¸­æ²¡æœ‰é…ç½® extraResourceã€‚
éœ€è¦æ·»åŠ ä»¥ä¸‹é…ç½®æ‰èƒ½å°† Python ä»£ç æ‰“å…¥å®‰è£…åŒ…ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  forge.config.ts éœ€è¦çš„ä¿®æ”¹:                                       â”‚
â”‚                                                                    â”‚
â”‚  packagerConfig: {                                                 â”‚
â”‚    asar: true,                                                     â”‚
â”‚    extraResource: [                                                â”‚
â”‚      "../mcp_tools",       â† MCP Server Python è„šæœ¬               â”‚
â”‚      "../core",            â† è®¾å¤‡ç®¡ç†æ ¸å¿ƒä»£ç                       â”‚
â”‚      "../utils",           â† å·¥å…·å‡½æ•°                              â”‚
â”‚      "../mobile_mcp",      â† åŒ…ä»£ç                                â”‚
â”‚      "../config.py",       â† é…ç½®æ–‡ä»¶                              â”‚
â”‚      "../requirements.txt" â† ä¾èµ–æ¸…å•                              â”‚
â”‚    ],                                                              â”‚
â”‚  },                                                                â”‚
â”‚                                                                    â”‚
â”‚  æ‰“åŒ…åä½ç½®:                                                        â”‚
â”‚                                                                    â”‚
â”‚  Mobile Agent.app/Contents/Resources/                              â”‚
â”‚  â”œâ”€â”€ app.asar              â† Electron åº”ç”¨                         â”‚
â”‚  â”œâ”€â”€ mcp_tools/            â† Python MCP Server                     â”‚
â”‚  â”‚   â””â”€â”€ mcp_server.py                                             â”‚
â”‚  â”œâ”€â”€ core/                 â† è®¾å¤‡ç®¡ç†æ ¸å¿ƒ                          â”‚
â”‚  â”‚   â”œâ”€â”€ mobile_client.py                                          â”‚
â”‚  â”‚   â”œâ”€â”€ device_manager.py                                         â”‚
â”‚  â”‚   â”œâ”€â”€ ios_client_wda.py                                         â”‚
â”‚  â”‚   â””â”€â”€ ...                                                       â”‚
â”‚  â”œâ”€â”€ utils/                                                        â”‚
â”‚  â”œâ”€â”€ mobile_mcp/                                                   â”‚
â”‚  â”œâ”€â”€ config.py                                                     â”‚
â”‚  â””â”€â”€ requirements.txt                                              â”‚
â”‚                                                                    â”‚
â”‚  process.resourcesPath â†’ æŒ‡å‘ Resources/ ç›®å½•                      â”‚
â”‚  getProjectRoot()      â†’ è¿”å› Resources/ è·¯å¾„                      â”‚
â”‚  getMcpServerPath()    â†’ Resources/mcp_tools/mcp_server.py         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Python è¿è¡Œæ—¶ç­–ç•¥ï¼ˆå·²å®ç°ï¼šå†…åµŒ venv_bundleï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Python è¿è¡Œæ—¶é€‰æ‹©ç­–ç•¥                              â”‚
â”‚                                                                      â”‚
â”‚  getPythonPath() æ£€æµ‹ä¼˜å…ˆçº§:                                         â”‚
â”‚                                                                      â”‚
â”‚  â‘  ç¯å¢ƒå˜é‡ $MCP_PYTHON                                             â”‚
â”‚     â””â”€â”€ ç”¨æˆ·æ˜¾å¼æŒ‡å®š Python è·¯å¾„                                     â”‚
â”‚                                                                      â”‚
â”‚  â‘¡ .venv_bundle (æ‰“åŒ…å†…åµŒç¯å¢ƒï¼Œç”Ÿäº§æ¨¡å¼å‘½ä¸­)                         â”‚
â”‚     â”œâ”€â”€ {root}/.venv_bundle/bin/python          (Unix)               â”‚
â”‚     â””â”€â”€ {root}/.venv_bundle/Scripts/python.exe  (Windows)            â”‚
â”‚                                                                      â”‚
â”‚  â‘¢ .venv (å¼€å‘æ¨¡å¼å‘½ä¸­)                                              â”‚
â”‚     â”œâ”€â”€ {root}/.venv/bin/python                 (Unix)               â”‚
â”‚     â””â”€â”€ {root}/.venv/Scripts/python.exe         (Windows)            â”‚
â”‚                                                                      â”‚
â”‚  â‘£ agent-app/.venv (agent-app å­ç›®å½•)                                â”‚
â”‚     â”œâ”€â”€ {root}/agent-app/.venv/bin/python       (Unix)               â”‚
â”‚     â””â”€â”€ {root}/agent-app/.venv/Scripts/python.exe (Windows)          â”‚
â”‚                                                                      â”‚
â”‚  â‘¤ ç³»ç»Ÿ Python                                                       â”‚
â”‚     â””â”€â”€ "python" (ä¾èµ– PATH)                                        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ„å»ºæµç¨‹ï¼ˆå¼€å‘è€…æ‰§è¡Œï¼‰

```bash
# æ–¹å¼ 1ï¼šä¸€é”®æ‰“åŒ…ï¼ˆæ¨èï¼‰
cd frontend
npm run make:full    # = bundle-python.sh + electron-forge make

# æ–¹å¼ 2ï¼šåˆ†æ­¥æ‰§è¡Œ
cd frontend
npm run bundle-python  # åˆ›å»º .venv_bundle + å®‰è£…ä¾èµ–
npm run make           # Electron Forge æ‰“åŒ…
```

`scripts/bundle-python.sh` åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š
1. åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.venv_bundle` è™šæ‹Ÿç¯å¢ƒ
2. `pip install -r requirements.txt` å®‰è£…æ‰€æœ‰è¿è¡Œæ—¶ä¾èµ–
3. æ¸…ç† `__pycache__`ã€`.dist-info` ç­‰ç¼“å­˜æ–‡ä»¶å‡å°ä½“ç§¯
4. `.venv_bundle` é€šè¿‡ `extraResource` æ‰“å…¥å®‰è£…åŒ…

**ç”¨æˆ·å®‰è£…åå¼€ç®±å³ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£… Python æˆ–è¿è¡Œä»»ä½•å‘½ä»¤ã€‚**

---

## é¦–æ¬¡å¯åŠ¨ Python ç¯å¢ƒæ£€æŸ¥

`mcp-manager.ts` ä¸­ `startMcpServer()` åœ¨ spawn å‰ä¼šæ‰§è¡Œ `checkPythonReady()`ï¼š

```
checkPythonReady(pythonCmd)
  â”‚
  â”œâ”€â”€ python --version          â† æ£€æŸ¥ Python å¯æ‰§è¡Œ
  â”‚   â”œâ”€â”€ æˆåŠŸ â†’ ç»§ç»­
  â”‚   â””â”€â”€ ENOENT â†’ "Python æœªæ‰¾åˆ°"ï¼ˆå†…åµŒç¯å¢ƒå­˜åœ¨æ—¶ä¸ä¼šè§¦å‘ï¼‰
  â”‚
  â””â”€â”€ python -c "import mcp; import starlette; import uvicorn"
      â”œâ”€â”€ æˆåŠŸ â†’ { ok: true } â†’ å¯åŠ¨ MCP Server
      â””â”€â”€ ImportError â†’ è¾“å‡ºé”™è¯¯æ—¥å¿—åˆ°æ§åˆ¶å°
```

- **æ­£å¼å®‰è£…åŒ…**ï¼š`.venv_bundle` å·²å†…åµŒï¼Œ`getPythonPath()` è‡ªåŠ¨æ‰¾åˆ°ï¼Œæ£€æŸ¥å¿…ç„¶é€šè¿‡
- **å¼€å‘æ¨¡å¼**ï¼šå¼€å‘è€…æœ¬åœ° `.venv` æˆ– `agent-app/.venv` åº”å·²å®‰è£…ä¾èµ–

---

## è¿›ç¨‹å…³ç³»å›¾

```
â”Œâ”€ æ“ä½œç³»ç»Ÿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚  â”Œâ”€ Electron ä¸»è¿›ç¨‹ (PID: 1000) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  main.js                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ BrowserWindow (æ¸²æŸ“è¿›ç¨‹ PID: 1001)                       â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€ React App (å‰ç«¯ UI)                                  â”‚  â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ spawn() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â”‚
â”‚  â”‚  â”‚                                     â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”Œâ”€ Python å­è¿›ç¨‹ (PID: 1002) â”€â”€â”€â”€â”â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  mcp_server.py --sse --port 3100â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚                                â”‚â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  â”œâ”€â”€ uvicorn (HTTP Server)     â”‚â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  â”‚   â””â”€â”€ :3100                 â”‚â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  â”‚                             â”‚â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  â””â”€â”€ MobileMCPServer           â”‚â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚      â”œâ”€â”€ MobileClient          â”‚â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚      â”‚   â””â”€â”€ u2/wda è¿æ¥       â”‚â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â”‚      â””â”€â”€ BasicMobileToolsLite  â”‚â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚                                     â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚   stdout/stderr â† pipe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€ IPC (ORPC) â†â†’ æ¸²æŸ“è¿›ç¨‹                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€ FastAPI åç«¯ (PID: 2000) â”€ ç‹¬ç«‹è¿›ç¨‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  uvicorn mobile_agent.api.app:app --port 8088                 â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ SSE è¿æ¥ â”€â”€â–º MCP Server :3100                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ LangGraph Agent                                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€ SQLite Storage                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  ä¿¡å·ä¸ç”Ÿå‘½å‘¨æœŸ:                                                     â”‚
â”‚  â”œâ”€â”€ Electron å¯åŠ¨ â†’ spawn Python å­è¿›ç¨‹                            â”‚
â”‚  â”œâ”€â”€ Electron will-quit â†’ SIGTERM â†’ Python å­è¿›ç¨‹                   â”‚
â”‚  â”œâ”€â”€ 3 ç§’æ— å“åº” â†’ SIGKILL â†’ å¼ºåˆ¶ç»ˆæ­¢                                â”‚
â”‚  â””â”€â”€ Python å­è¿›ç¨‹æ„å¤–é€€å‡º â†’ on("exit") â†’ mcpProcess = null         â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å·²å®Œæˆçš„æ‰“åŒ…é…ç½®

`forge.config.ts` å·²é…ç½® `extraResource`ï¼Œå°† Python ä»£ç æ‰“å…¥å®‰è£…åŒ…ï¼š

```typescript
// forge.config.tsï¼ˆå®é™…ä»£ç ï¼‰
import path from "node:path";

const projectRoot = path.resolve(__dirname, "..");

const config: ForgeConfig = {
  packagerConfig: {
    asar: true,
    extraResource: [
      path.join(projectRoot, "mcp_tools"),       // MCP Server è„šæœ¬
      path.join(projectRoot, "core"),             // è®¾å¤‡ç®¡ç†æ ¸å¿ƒä»£ç 
      path.join(projectRoot, "utils"),            // å·¥å…·å‡½æ•°
      path.join(projectRoot, "mobile_mcp"),       // åŒ…ä»£ç 
      path.join(projectRoot, "config.py"),        // é…ç½®æ–‡ä»¶
      path.join(projectRoot, "requirements.txt"), // ä¾èµ–æ¸…å•
      path.join(projectRoot, "__init__.py"),       // åŒ…å…¥å£
    ],
  },
  // ... å…¶ä½™é…ç½®ä¸å˜
};
```

`mcp-manager.ts` ä¸­ `startMcpServer()` å·²è®¾ç½® `cwd: getProjectRoot()`ï¼Œç¡®ä¿ Python è¿›ç¨‹çš„å·¥ä½œç›®å½•æ­£ç¡®ã€‚

æ‰“åŒ…å `process.resourcesPath` åŒ…å«è¿™äº›æ–‡ä»¶ï¼Œ`getProjectRoot()` åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹è¿”å›è¯¥è·¯å¾„ï¼Œæ•´ä¸ªé“¾è·¯è‡ªåŠ¨è´¯é€šï¼š

```
éªŒè¯ç»“æœï¼ˆ7/7 èµ„æºè·¯å¾„å…¨éƒ¨å­˜åœ¨ï¼‰:
  DIR   mcp_tools/       âœ…
  DIR   core/            âœ…
  DIR   utils/           âœ…
  DIR   mobile_mcp/      âœ…
  FILE  config.py        âœ…
  FILE  requirements.txt âœ…
  FILE  __init__.py      âœ…
```
