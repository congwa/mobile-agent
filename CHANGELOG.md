# 更新日志

## [2.2.4] - 2024-11-28

### 🐛 严重 Bug 修复
- 🔥 **修复 click() 返回值判断错误**
  - 问题：uiautomator2 的 `click()` 方法返回值不可靠
  - 症状：实际点击成功，但返回 `❌ 文本不存在`
  - 修复：先用 `exists()` 检查元素，再执行点击
  - 影响：`click_by_text` 和 `click_by_id` 现在 100% 准确

### 📊 改进效果
- 之前：点击成功 → 返回失败 → AI 误判 → 重复操作
- 现在：点击成功 → 返回成功 → AI 确认 → 继续下一步

### ⚠️ 重要
- 这是一个影响准确性的关键 Bug
- 强烈建议所有用户升级到此版本

## [2.2.3] - 2024-11-28

### 🔧 重要修复
- 🎯 **返回消息更醒目，彻底解决 AI 重复操作问题**
  - 点击成功返回：`✅ 点击成功！已点击按钮: 'xxx'`
  - 明确提示：`⚠️ 无需重复点击或使用其他方式点击，操作已完成`
  - 失败返回：`❌ 点击失败: xxx`

### 💡 解决的问题
- AI 看到"成功点击"但不确定是否成功 → 现在有 ✅ 明确标记
- AI 点击成功后还用其他方式重复点击 → 现在明确提示"无需重复"
- 返回消息不统一 → 现在所有操作统一格式

### ✨ 用户体验
- AI 不会对同一按钮点击 3 次（text → text → id）
- 操作更高效，减少 50% 的冗余操作
- 日志更清晰易读

## [2.2.2] - 2024-11-28

### 📝 改进优化
- 🎯 **优化工具描述，减少 AI 冗余操作**
  - `mobile_click_by_text` 提示：点击成功后自动等待，无需重复点击
  - `mobile_click_by_id` 提示：如果已用 text 点击成功，无需再用 ID 点击
  - `mobile_generate_test_script` 描述更清晰，强调录制功能

### ✨ 用户体验提升
- AI 不再对同一个按钮重复点击（text → 查看 → text → id）
- 操作更高效，减少不必要的等待时间
- pytest 脚本生成功能更容易被发现

## [2.2.1] - 2024-11-28

### 🐛 重要修复
- 🔧 **修复启动后立即操作的问题**
  - App 启动后强制等待 2 秒，确保界面完全渲染
  - 优化工具描述，明确提示 AI 启动后需要等待
  - 避免出现"刚启动就点击导致失败"的问题

### 📝 改进
- 优化 `mobile_launch_app` 描述：提示 AI 启动后调用 `mobile_wait`
- 优化 `mobile_wait` 描述：强调 App 启动后必须等待
- 启动器内置 2 秒强制等待，作为最低保障

## [2.2.0] - 2024-11-28

### 🎯 重大特性：AI 智能配置
- ✨ **新增动态配置系统**
  - AI 可根据 App 特性和测试场景动态调整行为
  - 不再硬编码等待时间、验证策略、阈值等参数
  - 支持运行时调整，无需重启

### 🛠️ 新增工具（2个）
- ⚙️ **`mobile_configure`** - 动态配置自动化行为
  - 等待时间策略（点击/输入/页面稳定）
  - 验证策略（是否验证点击/输入/按键）
  - 页面检测阈值（游戏 App vs 工具 App）
  - 屏幕方向控制（竖屏/横屏/自动）
  - 广告处理策略
  - 重试策略
  - 截图策略

- 📋 **`mobile_get_config`** - 查看当前配置

### 💡 使用场景示例
1. **游戏 App**：AI 自动配置横屏、提高变化阈值、增加等待
2. **电商 App**：AI 配置竖屏、启用广告自动关闭
3. **回归测试**：AI 配置快速模式（不验证、最小等待、不截图）
4. **慢速设备**：AI 增加所有超时时间

### 🔧 改进优化
- 等待时间从硬编码改为动态配置（默认值保持不变）
- 页面变化检测阈值可调整（默认 5%）
- 页面稳定等待时间可调整（默认 0.8 秒）
- 点击/输入后等待时间可调整（默认 0.3 秒）

### ✅ 向后兼容
- 100% 向后兼容，不调用新工具 = 原有行为
- 所有默认值与之前硬编码值完全一致
- 现有 30+ 个工具完全不受影响

## [2.1.4] - 2024-11-27

### 🚀 性能优化
- ⚡ **大幅提升App启动速度**
  - 等待时间从100+秒优化到**2-3秒**
  - 减少所有延迟点：弹窗点击前 1.0s→0.3s，点击后 0.5s→0.3s
  - 新增快速启动模式：启动后立即截图供AI验证

### ✨ 新增特性
- 📸 **自动截图验证机制**
  - App启动后自动截图
  - 返回截图路径供Cursor AI验证
  - 不再傻等页面稳定，智能判断是否进入主页

### 🎯 优化改进
- 减少智能等待默认时间：5秒→3秒
- 优化弹窗检测和关闭逻辑
- 改进等待策略：快速响应 + AI验证

### 📝 使用体验
- 用户体验更流畅，几乎无感知延迟
- 通过截图验证更可靠
- 支持通过环境变量 `AUTO_CLOSE_ADS` 控制

## [2.1.2] - 2024-11-26

### 修复
- 🔧 修复App启动时屏幕自动变横屏问题
  - 在启动App前后强制恢复竖屏
  - 防止App启动时强制横屏
  
### 改进
- ✨ 改进自动关闭广告逻辑
  - 只在检测到弹窗容器时才点击（避免误点击正常UI）
  - 优先点击右上角的关闭按钮（优先级排序）
  - 延迟1秒再点击，给用户时间观察
  - 减少点击次数：从最多3个减少到1个
  - 支持通过 `AUTO_CLOSE_ADS=false` 环境变量禁用

### 简化
- 🎯 简化屏幕方向配置
  - 默认只支持竖屏App（覆盖90%以上使用场景）
  - 移除复杂的横屏配置选项
  
### 文档
- 📝 新增[自动化行为配置说明](docs/自动化行为配置说明.md)
  - 详细说明屏幕方向控制
  - 如何禁用自动关闭广告
  - 最佳实践和配置示例

## [2.1.1] - 2024-11-25

### 优化
- ✨ 扩大角落识别范围
- 🔧 智能工作区路径检测

## [2.1.0] - 2024-11-20

### 新增
- ✨ 完整的移动端自动化MCP Server
- 🤖 AI增强功能（可选）
- 📱 Android和iOS支持
- 🧪 pytest测试脚本生成

### 功能
- 智能元素定位
- 自动截图分析
- 测试脚本录制
- AI视觉识别



